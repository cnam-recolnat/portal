#-----------------------------------------------------------8<----------------------------------------------------------
# Consul for Docker
# Adapted from https://github.com/mohitarora/consul-docker
#-----------------------------------------------------------8<----------------------------------------------------------
FROM		tutum/debian-wheezy
MAINTAINER	Arie Benichou <arie.benichou@gmail.com>
#-----------------------------------------------------------8<----------------------------------------------------------
RUN			apt-get update && apt-get dist-upgrade -y -q && \
			apt-get install -y -q \
				locate \
				nano \
		  		curl \
		  		wget \
		  		git \
				netcat \
				nmap \
		  		net-tools \
		  		lsof \
		  		rsync \
		  		unzip
#-----------------------------------------------------------8<----------------------------------------------------------
ADD			https://dl.bintray.com/mitchellh/consul/0.4.1_web_ui.zip /tmp/consul.zip
RUN 		cd /bin && unzip /tmp/consul.zip && chmod +x /bin/consul && rm /tmp/consul.zip
#-----------------------------------------------------------8<----------------------------------------------------------
ADD			https://dl.bintray.com/mitchellh/consul/0.4.1_web_ui.zip /tmp/webui.zip
RUN			cd /tmp && unzip /tmp/webui.zip && mv dist /ui && rm /tmp/webui.zip
#-----------------------------------------------------------8<----------------------------------------------------------
ADD 		./config /config/
ONBUILD ADD ./config /config/
#-----------------------------------------------------------8<----------------------------------------------------------
ADD 		./launch.sh /bin/launch.sh
RUN			chmod +x /bin/launch.sh
#-----------------------------------------------------------8<----------------------------------------------------------
RUN			apt-get autoclean && apt-get autoremove && updatedb
#-----------------------------------------------------------8<----------------------------------------------------------
EXPOSE 		8300 8301 8301/udp 8302 8302/udp 8400 8500 53/udp
#-----------------------------------------------------------8<----------------------------------------------------------
VOLUME 		["/data"]
#-----------------------------------------------------------8<----------------------------------------------------------
ENTRYPOINT	["/bin/launch.sh"]
#-----------------------------------------------------------8<----------------------------------------------------------