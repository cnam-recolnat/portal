#-----------------------------------------------------------8<----------------------------------------------------------
# Base with SSH support
#-----------------------------------------------------------8<----------------------------------------------------------
FROM		tutum/debian-wheezy
MAINTAINER	Arie Benichou <arie.benichou@gmail.com>
#-----------------------------------------------------------8<----------------------------------------------------------
# System Tools
#-----------------------------------------------------------8<----------------------------------------------------------
RUN			apt-get update && apt-get dist-upgrade -y -q && \
			apt-get install -y -q \
				locate \
				nano \
		  		curl \
		  		wget \
		  		git \
				netcat \
		  		net-tools \
		  		lsof \
		  		rsync
#-----------------------------------------------------------8<----------------------------------------------------------
# HAProxy
#-----------------------------------------------------------8<----------------------------------------------------------
RUN			echo "deb http://http.debian.net/debian wheezy-backports main" > /etc/apt/sources.list.d/backports.list && \
			apt-get update && apt-get install -y -q haproxy -t wheezy-backports
#-----------------------------------------------------------8<----------------------------------------------------------
# etcd
#-----------------------------------------------------------8<----------------------------------------------------------
RUN			curl -L  https://github.com/coreos/etcd/releases/download/v2.0.0-rc.1/etcd-v2.0.0-rc.1-linux-amd64.tar.gz \
				-o etcd-v2.0.0-rc.1-linux-amd64.tar.gz && tar xzvf etcd-v2.0.0-rc.1-linux-amd64.tar.gz
#-----------------------------------------------------------8<----------------------------------------------------------
RUN			wget https://github.com/kelseyhightower/confd/releases/download/v0.6.3/confd-0.6.3-linux-amd64 && \
				mv confd-0.6.3-linux-amd64 /usr/local/bin/confd && \
				chmod +x /usr/local/bin/confd && \
				mkdir -p /etc/confd/{conf.d,templates}
#-----------------------------------------------------------8<----------------------------------------------------------
# Cleaning
#-----------------------------------------------------------8<----------------------------------------------------------
RUN			apt-get autoclean && apt-get autoremove
#-----------------------------------------------------------8<----------------------------------------------------------
# Indexing
#-----------------------------------------------------------8<----------------------------------------------------------
RUN			updatedb
#-----------------------------------------------------------8<----------------------------------------------------------
# Workspace
#-----------------------------------------------------------8<----------------------------------------------------------
ADD			./⁄/root/ /root/
RUN			chmod -R +x /root/*.sh
#-----------------------------------------------------------8<----------------------------------------------------------
# Main
#-----------------------------------------------------------8<----------------------------------------------------------
EXPOSE 80
ENTRYPOINT  ["/root/main.sh"]
#-----------------------------------------------------------8<----------------------------------------------------------
